"use strict";(self.webpackChunk_9_tq_doc=self.webpackChunk_9_tq_doc||[]).push([[52],{7198:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var i=s(5893),t=s(1151);const o={sidebar_position:2},a="Jobs Dashboard",r={id:"jobs-dashboard",title:"Jobs Dashboard",description:"La gem jobs dashboard permet de cr\xe9er un dashboard des jobs sidekiq afin d'y afficher des infos tel que la dur\xe9e...",source:"@site/docs/jobs-dashboard.md",sourceDirName:".",slug:"/jobs-dashboard",permalink:"/lib-docs/docs/jobs-dashboard",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/jobs-dashboard.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"9tq toolbox",permalink:"/lib-docs/docs/ntq_tools"},next:{title:"Backups manager",permalink:"/lib-docs/docs/scalingo/backups"}},d={},l=[{value:"Installation",id:"installation",level:2},{value:"Utilisation",id:"utilisation",level:2},{value:"Options",id:"options",level:2},{value:"Ajout d&#39;une ligne de log ou de m\xe9tadonn\xe9es \xe0 un job",id:"ajout-dune-ligne-de-log-ou-de-m\xe9tadonn\xe9es-\xe0-un-job",level:2},{value:"Ajout d&#39;un attribut custom commun a tous les jobs",id:"ajout-dun-attribut-custom-commun-a-tous-les-jobs",level:2},{value:"HTTP Basic auth",id:"http-basic-auth",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"jobs-dashboard",children:"Jobs Dashboard"}),"\n",(0,i.jsx)(n.p,{children:"La gem jobs dashboard permet de cr\xe9er un dashboard des jobs sidekiq afin d'y afficher des infos tel que la dur\xe9e..."}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",metastring:'title="Gemfile"',children:"# Use the latest version on master branch\ngem 'jobs_dashboard', git: 'https://github.com/9troisquarts/jobs_dashboard'\n\n# Use the last published version\ngem 'jobs_dashboard'\n"})}),"\n",(0,i.jsx)(n.p,{children:"And then execute:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bundle install\n"})}),"\n",(0,i.jsx)(n.p,{children:"G\xe9n\xe9rer les migrations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"rails generate active_record:job_log_migration\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the migration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"rails db:migrate\n"})}),"\n",(0,i.jsx)(n.h2,{id:"utilisation",children:"Utilisation"}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"danger",children:(0,i.jsx)(n.p,{children:"Le log des jobs sidekiq fonctionne uniquement avec les jobs qui include Sidekiq::Worker, il n'est pas possible de l'utiliser avec ApplicationJob pour le moment"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",metastring:'title="initializers/sidekiq.rb"',children:"require 'jobs_dashboard'\n\nSidekiq.configure_client do |config|\n  JobsDashboard.configure_client_middleware config\nend\n\nSidekiq.configure_server do |config|\n  JobsDashboard.configure_server_middleware config\n  JobsDashboard.configure_client_middleware config\nend\n"})}),"\n",(0,i.jsx)(n.p,{children:"Mount Engine to access web component:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",metastring:'title="routes.rb"',children:"require 'jobs_dashboard/engine'\n\nRails.application.routes.draw do\n  mount JobsDashboard::Engine, at: '/jobs_dashboard'\nend\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Acc\xe8der aux dashboard en vous dirigeant vers l'adresse ",(0,i.jsx)(n.code,{children:"/jobs_dashboard"})," (ou tout autre url configurer dans le fichier routes.rb)"]}),"\n",(0,i.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,i.jsx)(n.p,{children:"Des options sp\xe9cifiques a jobs_dashboard peuvent \xeatre ajout\xe9es aux jobs sidekiq de la mani\xe8re suivantes :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"  sidekiq_options jobs_dashboard: { skip: true }\n"})}),"\n",(0,i.jsx)(n.p,{children:"Voici une liste exhaustive des options disponible"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Cl\xe9"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"description"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"default"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"skip"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"Permet d'ignorer un job et de ne pas le loger sur le dashboard"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"false"})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"ajout-dune-ligne-de-log-ou-de-m\xe9tadonn\xe9es-\xe0-un-job",children:"Ajout d'une ligne de log ou de m\xe9tadonn\xe9es \xe0 un job"}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"danger",children:(0,i.jsx)(n.p,{children:"Afin de pouvoir ajouter un de ces attributes, le job doit include le module JobsDashboard::Worker en plus de Sidekiq::Worker"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Metadonn\xe9e : Les m\xe9tadonn\xe9es d'un job sont les valeurs qui seront affich\xe9 dans l'index des jobs sur le dashboard, et afficher sur la partie droite de la page d\xe9taill\xe9 du job"}),"\n",(0,i.jsx)(n.li,{children:"Ligne de log : Les lignes de logs sont affich\xe9es sur la page du job, elle permettent d'apporter des infos sur l'execution d'un job, comme le nombre de ligne import\xe9es ou le d\xe9tail d'un mail envoy\xe9 \xe0 un utilisateurs"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Dans les premi\xe8res lignes du job, ajouter l'import de JobsDashboard::Worker tel que :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"include Sidekiq::Worker\ninclude JobsDashboard::Worker\n"})}),"\n",(0,i.jsx)(n.p,{children:"Dans le corps du job :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:'# Ajout d\'une ligne de log\nadd_job_log_line("123 lignes ont \xe9t\xe9 import\xe9es")\n\n# Ajout d\'une m\xe9tadonn\xe9e\nadd_job_metadata("lines_count", 123)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Autres exemples :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",metastring:'title="job.rb"',children:'add_job_metadata("email_count", User.all.size)\nadd_job_metadata("mailer_type", "missions")\nUser.all.each do |user|\n  add_log_line("Envoie d\'un email avec X missions \xe0 l\'utilisateur #{user.email}")\nend\n'})}),"\n",(0,i.jsx)(n.h2,{id:"ajout-dun-attribut-custom-commun-a-tous-les-jobs",children:"Ajout d'un attribut custom commun a tous les jobs"}),"\n",(0,i.jsx)(n.p,{children:"Si vous souhaitez ajouter un champ a tous les jobs qui sera utilis\xe9 comme filtre / colonnes, suivez les instructions ci dessous :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"bundle exec rails g migration add_{{attribute_name}}_to_jobs_dashboard_job_logs\n"})}),"\n",(0,i.jsx)(n.p,{children:"In an initializer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"JobsDashboard.setup do |config|\n  config.additional_params = [\n    {\n      attribute_name: 'attribute_name',\n      title: 'Title displayed on column header and more'\n    }\n  ]\nend\n"})}),"\n",(0,i.jsx)(n.p,{children:"In the job"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"include JobsDashboard::Worker\nset_job_parameter(attribute_name, value)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"http-basic-auth",children:"HTTP Basic auth"}),"\n",(0,i.jsx)(n.p,{children:"L'ajout d'une authentification Basic est requise pour le bon fonctionnement de la GEM, pour la param\xe8trer, ajouter ces deux variables d'environnement dans votre fichier .rbenv-vars"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title=".rbenv-vars"',children:"JOBS_DASHBOARD_AUTH_PASSWORD=mon_password\nJOBS_DASHBOARD_AUTH_USERNAME=mon_user\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Attention",type:"danger",children:(0,i.jsx)(n.p,{children:"L'ajout doit aussi \xeatre fait sur l'environnement de production et staging"})})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>a});var i=s(7294);const t={},o=i.createContext(t);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);